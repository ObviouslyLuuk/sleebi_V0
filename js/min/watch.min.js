 function redirect_results(query){ redirect_to(`/?q=${query}`, {page:'results', query:query});};function redirect_watch(video_id, embed=false, replace=false){ let url=get_video_url(video_id, embed, undefined, true, true);redirect_to(url, {page:'watch', video_id:video_id, embed:embed, replace:replace});};function redirect_home(){ redirect_to('/', {page:'home'});};function redirect_to(url, kwargs){ console.log(`===========================\nRedirecting to "${url}". kwargs:${JSON.stringify(kwargs)}`);if(kwargs.replace){ window.history.replaceState(kwargs, null, url);console.log("Replaced state with "+url);} else { save_time_if_video();window.history.pushState(kwargs, null, url);console.log("Pushed state with "+url);};window.dispatchEvent(new Event('pushstate'));};function save_time_if_video(){ URLPARAMS=new URLSearchParams(window.location.search);if(URLPARAMS.get('v')){ if(EMBED &&(!yt_player ||!yt_player.getDuration)){ return;};if(!EMBED &&!video.duration){ return;};let video_id=URLPARAMS.get('v');let time=parseInt(getTime()*1000);let total_duration=parseInt(getDuration()*1000);if(total_duration - time<5000){ return;};let url=get_video_url(video_id, EMBED, time, true);window.history.replaceState({page:'watch', video_id:video_id, embed:EMBED, time:time}, null, url);console.log(`Replaced state with time ${time}`)};};/** * Helper functions */ window.mobileCheck=function(){ let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm(os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s)|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp(i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac(|\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt(|\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg(g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v)|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v)|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-|)|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true;})(navigator.userAgent||navigator.vendor||window.opera);return check;};document.body.dataset.mobile=mobileCheck();if(document.body.dataset.mobile=='false'){ let style=document.createElement('style');style.innerHTML=`::-webkit-scrollbar { width:7px;}::-webkit-scrollbar-track { background:var(--divider-color);}::-webkit-scrollbar-thumb { background:var(--disabled-color);border-radius:10px;opacity:0.8;}::-webkit-scrollbar-thumb:hover { opacity:1;} `;document.head.appendChild(style);};/** * Tablet check isn't super reliable because some tablets are exactly like desktops except with touchscreens * * @returns {boolean} - True if the device is a tablet, false otherwise. */ window.tabletCheck=function(){ let check=false;(function(a){if(/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(a))check=true;})(navigator.userAgent||navigator.vendor||window.opera);return check;};window.iOSCheck=function(){ let check=false;(function(a){if(/iPhone|iPod/.test(a))check=true;})(navigator.userAgent||navigator.vendor||window.opera);return check;};/** * Fetches the HTML from 'html/min/${page}.min.html' and injects it into the container div. * Sets the 'HTML_TEMPLATES[page]' to the html after successful injection. * Fires the '{page}_html_ready' event after injection. * * @returns {void} */ function fetch_html(page, selector=null){ fetch(`html/min/${page}.min.html`).then(response=>response.text()).then(html=>{ if(selector){ let container=document.querySelector(selector);container.innerHTML=html;} HTML_TEMPLATES[page]=html;}).catch(error=>console.error('Error fetching HTML:', error)).then(()=>{ window.dispatchEvent(new Event(`${page}_html_ready`));});};const HTML_TEMPLATES={};function views_add_commas(views){ return views.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");};/** * Abbreviates the number of views to the format "X.XB", "X.XM", "X.XK", or "X". * @param {number} views - The number of views. * @returns {string|number} - The abbreviated views. */ function views_abbr(views){ if(views>=1000000000)return `${(views / 1000000000).toFixed(1)}B`;else if(views>=1000000)return `${(views / 1000000).toFixed(1)}M`;else if(views>=1000)return `${(views / 1000).toFixed(1)}K`;else return views;};/** * Formats milliseconds as time in the format "hh:mm:ss" or "mm:ss". * @param {number} ms - The number of milliseconds to format. * @returns {string} The formatted time string. */ function format_ms_as_time(ms){ let seconds=Math.floor(ms / 1000);let minutes=Math.floor(seconds / 60);let hours=Math.floor(minutes / 60);seconds -=minutes * 60;minutes -=hours * 60;if(hours>0)return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;else return `${minutes}:${seconds.toString().padStart(2, '0')}`;};/** * Calculates the milliseconds from a given time string. * * @param {string} time - The time string in the format "HH:MM:SS" or "MM:SS". * @returns {number} The calculated milliseconds. */ function calc_ms_from_time(time){ if(!/^\d{1,2}:\d{2}(:\d{2})?$/.test(time))throw new Error('Time must be in the format "HH:MM:SS" or "MM:SS"');let time_split=time.split(':');let hours=0;let minutes=0;let seconds=0;if(time_split.length==2){ minutes=parseInt(time_split[0]);seconds=parseInt(time_split[1]);} else if(time_split.length==3){ hours=parseInt(time_split[0]);minutes=parseInt(time_split[1]);seconds=parseInt(time_split[2]);};return(hours * 3600+minutes * 60+seconds)* 1000;};function create_and_append(type, parent=null, id=null, class_=null){ if(parent==null)parent=document.body;let element=document.createElement(type);if(id!=null)element.id=id;if(class_!=null)element.setAttribute('class', class_);parent.appendChild(element);return element;};function empty_element(element){ while(element.firstChild){ element.removeChild(element.firstChild);};};function get_video_url(video_id, embed=false, t=0, relative=false, redirect=false){ let urlend=`/${redirect ? '':'v.html'}?v=${video_id}${embed ? '&embed=true':''}${t>0 ? `&t=${t}`:''}`;if(relative){ return urlend;};return `https://sleebi.net${urlend}`;};function get_thumb_url(video_id){ if(video_id=="demo480x852"){ video_id="NJoFdZFvfcc";} return `https://i.ytimg.com/vi_webp/${video_id}/maxresdefault.webp`;};function get_thumb_urls(video_id){ if(video_id=="demo480x852"){ video_id="NJoFdZFvfcc";};return { 'low':`https://i.ytimg.com/vi_webp/${video_id}/mqdefault.webp`, 'medium':`https://i.ytimg.com/vi_webp/${video_id}/hqdefault.webp`, 'high':`https://i.ytimg.com/vi_webp/${video_id}/sddefault.webp`, 'maxres':get_thumb_url(video_id), };};function get_download_url(video_id){ if(video_id=="demo480x852"){ return "https://sleebi.net/videos/demo480x852.mp4";} return `https://sleebi-video-bucket.s3.eu-west-3.amazonaws.com/ObviouslyASMR/${video_id}.mp4`;};function get_date(video_info, format='Mon DD, YYYY'){ let date=new Date(video_info['published']);if(format=='Mon DD, YYYY'){ let day=date.getDate();let month=date.toLocaleString('default', { month:'short' });let year=date.getFullYear();return `${month} ${day}, ${year}`;} else if(format=='DD-MM-YYYY'){ let day=date.getDate();let month=date.getMonth()+1;let year=date.getFullYear();return `${day}-${month}-${year}`;};};function get_description(video_info){ let description=video_info['description'];let index=description.indexOf('Go ahead and ');if(index!=-1)description=description.substring(0, index);let regex=/https?:\/\/[^\s]+/g;let matches=description.match(regex);if(matches!=null){ for(let match of matches){ description=description.replace(match, `<a href="${match}">${match}</a>`);};};regex=/\d{1,2}:\d{2}(:\d{2})?/g;matches=description.match(regex);if(matches!=null){ for(let match of matches){ description=description.replace(match, `<a onclick="seekTo(calc_ms_from_time('${match}'))">${match}</a>`);};};description=description.replace(/\n/g, '<br>');return description;};function get_keywords(video_info){ let keywords=video_info['tags'];if(keywords==null)return [];return keywords.split(',');};/** * Creates an overlay element and appends it to the specified parent element. * If no parent element is provided, the overlay is appended to the document body. * * @param {HTMLElement} [parent=document.body] - The parent element to append the overlay to. * @param {string} [class_=null] - The class name to add to the overlay. * @param {boolean} [add_close_btn=true] - Whether or not to add a close button to the overlay. * @param {number} [timer=null] - The amount of time in milliseconds to wait before automatically closing the overlay. * @param {boolean} [add_background=true] - Whether or not to add a background to the overlay. * @returns {HTMLElement} The content element of the created overlay. */ function create_overlay(parent=document.body, class_='', add_close_btn=true, timer=null, add_background=true){ let overlay_background, overlay;if(add_background){ overlay_background=create_and_append('div', parent, null, 'overlay_background');overlay=create_and_append('div', overlay_background, null, 'overlay '+class_);} else { overlay=create_and_append('div', parent, null, 'overlay '+class_);overlay_background=overlay;};let overlay_content=create_and_append('div', overlay, null, 'overlay_content');if(add_close_btn){ let overlay_close_btn=create_and_append('div', overlay_content, null, 'overlay_close_btn clickable_icon');overlay_close_btn.innerHTML=`<svg class="icon"><use xlink:href="images/sprite.svg#icon-cross"></use></svg>`;overlay_close_btn.addEventListener('click', function(){ overlay_background.remove();});overlay_background.addEventListener('click', function(event){ if(event.target==overlay_background){ overlay_background.remove();};});window.addEventListener('keydown', function(event){ if(event.key=='Escape'){ overlay_background.remove();};});} else { setTimeout(function(){ window.addEventListener('click', function(){ overlay_background.remove();});}, 100);window.addEventListener('keydown', function(event){ if(event.key=='Escape'){ overlay_background.remove();};});overlay.addEventListener('animationend', function(){ overlay_background.remove();});};if(timer!=null){ setTimeout(function(){ overlay_background.remove();}, timer);};return overlay_content;};function create_message_overlay(message, parent=document.body, duration=2000){ let ani_str=`${duration/1000}s ease-in-out 0s 1 normal forwards running slideUpAndAway`;let overlay_content=create_overlay(parent, 'message_overlay', false, undefined, false);overlay_content.parentElement.style.animation=ani_str;let overlay_message=create_and_append('div', overlay_content, null, 'overlay_message');overlay_message.innerText=message;console.log(overlay_message);return overlay_content;};function add_rec_vid(parent, info, img_loading='eager', max_width=1280){ let rec_vid=create_and_append('div', parent, null, 'rec_vid vid_tile');rec_vid.addEventListener('click', function(){ redirect_watch(info.id);});let rec_thumb_div_container=create_and_append('div', rec_vid, null, 'rec_thumb_div_container');let rec_thumb_div=create_and_append('div', rec_thumb_div_container, null, 'rec_thumb_div');let rec_thumb_img=create_and_append('img', rec_thumb_div, null, 'rec_thumb_img');thumb_urls=get_thumb_urls(info.id);rec_thumb_img.width=480;rec_thumb_img.height=270;if(img_loading=='lazy'){ rec_thumb_img.loading='lazy';};let sizes='';let widths=[320, 480, 640, 1280];for(let width of widths){ if(width<max_width){ sizes+=`(max-width:${width}px)${width}px, `;} else { sizes+=`${max_width}px`;break;};};rec_thumb_img.sizes=sizes;rec_thumb_img.srcset=` ${thumb_urls['low']} 320w, ${thumb_urls['medium']} 480w, ${thumb_urls['high']} 640w, ${thumb_urls['maxres']} 1280w `;rec_thumb_img.src=thumb_urls['low'];rec_thumb_img.alt="video thumbnail";let rec_duration=create_and_append('div', rec_thumb_div, null, 'rec_duration');rec_duration.innerText=format_ms_as_time(info.duration*1000);let rec_play_btn=create_and_append('div', rec_thumb_div, null, 'rec_play_btn');rec_play_btn.innerHTML=`<svg class="play-icon" viewBox="0 0 24 24"><path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" /></svg>`;let rec_metadata=create_and_append('div', rec_vid, null, 'rec_metadata');let rec_title=create_and_append('h6', rec_metadata, null, 'rec_title');rec_title.innerText=info.title;let rec_channel=create_and_append('div', rec_metadata, null, 'rec_channel');rec_channel.innerText=info.channel_name;let rec_views_date=create_and_append('div', rec_metadata, null, 'rec_views-date');let rec_views=create_and_append('span', rec_views_date, null, 'rec_views');rec_views.innerText=views_abbr(info.views)+' views';let rec_date=create_and_append('span', rec_views_date, null, 'rec_date date-span');rec_date.innerText=get_date(info, format='DD-MM-YYYY');if(img_loading!='lazy'){ let rec_thumb_img_interval=setInterval(function(){ rec_thumb_img.addEventListener('load', function(){ clearInterval(rec_thumb_img_interval);});let rect=rec_thumb_img.getBoundingClientRect();if(rect.top>window.innerHeight || rect.bottom<0){ rec_thumb_img.loading='lazy';} else { rec_thumb_img.loading=img_loading;};}, 50);};return rec_vid;};/** * Returns an array of search results based on the given query and videos. * The results are sorted by relevance, which is determined by the title that contains the most words in the query. * * @param {string} query - The search query. * @param {Array<Object>} videos - An array of video objects. * @return {Array<Object>} An array of video objects sorted by relevance. */ function get_search_results(query, videos){ let results=[];query=query.replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"");let query_words=query.split(' ');for(let video of videos){ let title=video['title'];let relevance=0;for(let word of query_words){ if(title.includes(word)){ relevance++;};};results.push([video, relevance]);};results.sort((a, b)=>new Date(b[0]["published"])- new Date(a[0]["published"]));results.sort((a, b)=>b[1] - a[1]);results=results.map(result=>result[0]);return results;};HTML_TEMPLATES['home']=null;fetch_html('home');function placeHomeContent(){ let container=document.querySelector('#content-container');container.innerHTML='<div class="spinner active"><img src="images/logo.svg"></div>';if(!HTML_TEMPLATES['home']){ console.log("placeHomeContent:home html not loaded yet, waiting...");window.addEventListener('home_html_ready', placeHomeContent);return;};container.innerHTML=HTML_TEMPLATES['home'];if(!videos_info){ console.log("placeHomeContent:videos_info not loaded yet, waiting...");window.addEventListener('videos_info_loaded', placeHomeContent);return;};document.querySelector('#navbar').dataset.mode="default";document.title="Sleebi - for Sleep";let num_videos=Object.keys(videos_info).length;let num_videos_div=document.querySelector('#num_videos');num_videos_div.innerHTML=num_videos;let rec_vids=get_search_results("", Object.values(videos_info));for(let vid_info of rec_vids){ add_rec_vid(document.querySelector('#search_results'), vid_info, 'eager', 640,);};document.querySelector('#content-container').dataset.page="home";window.scrollTo(0,0);};HTML_TEMPLATES['results']=null;fetch_html('results');function placeResultsContent(){ let container=document.querySelector('#content-container');container.innerHTML='<div class="spinner active"><img src="images/logo.svg"></div>';if(!HTML_TEMPLATES['results']){ console.log("placeResultsContent:results html not loaded yet, waiting...");window.addEventListener('results_html_ready', placeResultsContent);return;};document.querySelector('#navbar').dataset.mode="search";URLPARAMS=new URLSearchParams(window.location.search);QUERY=URLPARAMS.get('q');console.log("query:", QUERY);document.title=`Search:${QUERY}`;let search_input=document.querySelector('#search-input');search_input.value=QUERY;document.querySelector('#content-container').innerHTML=HTML_TEMPLATES['results'];if(!videos_info){ console.log("placeResultsContent:videos_info not loaded yet, waiting...");window.addEventListener('videos_info_loaded', placeResultsContent);return;};let rec_vids=get_search_results(QUERY, Object.values(videos_info));for(let vid_info of rec_vids){ add_rec_vid(document.querySelector('#search_results'), vid_info, 'eager', 320,);};document.querySelector('#content-container').dataset.page="results";window.scrollTo(0,0);};/** * This file fetches the watch html * then that fires an event which calls loadPlayer()* loadPlayer()fetches the player html(or loads the yt embed js)* then that fires an event which calls placeWatchContent()* placeWatchContent()waits for the player html / yt iframe api to load and adds an event listener if necessary * then it places the watch overlay if necessary * then it waits for videos_info to load and adds an event listener if necessary * then it places the watch content */ const PLAY_WHEN_CLICKED=true;if(!PLAY_WHEN_CLICKED){ window.addEventListener('play_requested', function(){ let video=document.querySelector('video');if(video.src!="")return;video.src=get_download_url(VIDEO_ID);});};var PREV_VIDEO_ID;var PREV_EMBED;var EMBED;var yt_player;const WATCH_LOAD=(document.querySelector('#watch_overlay')&& 1);if(!WATCH_LOAD){ HTML_TEMPLATES['watch']=null;fetch_html('watch');};if(EMBED){ load_embed_script();};function load_embed_script(){ console.log("loadPlayer:loading yt embedding js...");script=document.createElement('script');script.src='js/util/embed.js';script.id='embed_script';document.body.appendChild(script);};window.addEventListener('player_ready',()=>{ console.log("player ready");prompt_player(VIDEO_ID);});function autoplay_video(){ let video_ids=Object.keys(videos_info);let random_video_id=video_ids[Math.floor(Math.random()* video_ids.length)];if(random_video_id==VIDEO_ID){ autoplay_video();return;};redirect_watch(random_video_id);};function placeWatchContent(){ VIDEO_ID=URLPARAMS.get('v');console.log("video_id:", VIDEO_ID);EMBED=(URLPARAMS.get('embed')!=null);if(PREV_EMBED==undefined){ } else if(PREV_EMBED!=EMBED){ console.log("placeWatchContent:switching player...");destroyVideo(PREV_EMBED);if(!EMBED){window.dispatchEvent(new Event('player_ready'));};} else { if(VIDEO_ID==PREV_VIDEO_ID){ console.log("placeWatchContent:video_id is the same as PREV_VIDEO_ID");document.body.classList.add('watch');window.dispatchEvent(new Event('exitpip'));document.querySelector('.vid_player_container').scrollIntoView();play();return;} else { prompt_player(VIDEO_ID);};};if(!HTML_TEMPLATES['watch'] &&!WATCH_LOAD){ console.log("placeWatchContent:watch/player html not loaded yet, waiting...");window.addEventListener('watch_html_ready', placeWatchContent, {once:true});return;};let watch_overlay=document.querySelector('#watch_overlay');if(HTML_TEMPLATES['watch'] &&!watch_overlay &&!WATCH_LOAD){ watch_overlay=create_and_append('div', document.body, 'watch_overlay');document.querySelector('#watch_overlay').innerHTML=HTML_TEMPLATES['watch'];console.log("placeWatchContent:watch_overlay now created");if(!EMBED){window.dispatchEvent(new Event('player_ready'));};} else if(watch_overlay && WATCH_LOAD){ console.log("placeWatchContent:watch_overlay already exists");if(!EMBED){window.dispatchEvent(new Event('player_ready'));};};if(!document.querySelector('#player_script')&&!WATCH_LOAD){ console.log("player.js not loaded yet, loading...");let script=document.createElement('script');script.src='js/player.js';script.id='player_script';document.body.appendChild(script);};if(EMBED &&!yt_player){ load_yt_player();};document.body.classList.add('watch');window.dispatchEvent(new Event('exitpip'));document.querySelector('.vid_player_container').scrollIntoView();if(!videos_info){ console.log("placeWatchContent:videos_info not loaded yet, waiting...");window.addEventListener('videos_info_loaded', placeWatchContent);return;};if(Object.keys(videos_info).includes(VIDEO_ID)){ let video_info=videos_info[VIDEO_ID];console.log("video_info:", video_info);fill_video_info(video_info);add_rec_vids(video_info['title']);} else { console.log("placeWatchContent:video_id not found in videos_info");document.title="Sleebi";let video_title=document.querySelector('#vid_title');video_title.innerHTML="This video is not in Sleebi's database";let video_description=document.querySelector('#vid_description');video_description.innerHTML=`but you can still watch it here${' '}:)<br><br>Keep in mind that this video's creator will only be compensated if you see an ad.<br><br>At the moment it's unclear whether YouTube will serve ads on Sleebi. If they do, the creator${' '}(and YouTube)${' '} will be compensated like normal. Regardless, Sleebi doesn't make any money from this. Also the video will be stopped just before the end so you won't get any postroll ads. `;let yt_sub=document.querySelector('#yt_sub');yt_sub.href="https://www.youtube.com/watch?v="+VIDEO_ID;let video_views=document.querySelector('#vid_viewcount');video_views.innerHTML="";let video_date=document.querySelector('#vid_date');video_date.innerHTML="";let video_channel=document.querySelector('#vid_channel_name');video_channel.innerHTML="";add_rec_vids("");} let share_btn=document.querySelector('#vid_share_btn');share_btn.addEventListener('click', add_share_overlay);let embed_script=document.querySelector('#embed_script');if(!embed_script){ console.log("embed.js not loaded yet, loading...");let script=document.createElement('script');script.src='js/util/embed.js';script.id='embed_script';script.async=true;script.defer=true;document.body.appendChild(script);};PREV_VIDEO_ID=VIDEO_ID;};function fill_video_info(video_info){ document.title=video_info['title'];let video_title=document.querySelector('#vid_title');video_title.innerHTML=video_info['title'];let pip_video_title=document.querySelector('.pip-player-title');pip_video_title.innerHTML=video_info['title'];let video_views=document.querySelector('#vid_viewcount');video_views.innerHTML=`${views_add_commas(video_info['views'])} views`;let video_description=document.querySelector('#vid_description');video_description.innerHTML=get_description(video_info);let video_date=document.querySelector('#vid_date');video_date.innerHTML=get_date(video_info);let video_channel=document.querySelector('#vid_channel_name');video_channel.innerHTML=video_info['channel_name'];video_channel.addEventListener('click', function(){ window.location.href=`?c=${video_info['channel_@name']}`;});let pip_video_channel=document.querySelector('.pip-player-channel-name');pip_video_channel.innerHTML=video_info['channel_name'];let yt_sub=document.querySelector('#yt_sub');yt_sub.href=`https://www.youtube.com/channel/${video_info['channel_id']}?sub_confirmation=1&feature=subscribe-embed-click`;};function add_rec_vids(query){ let rec_vids=get_search_results(query, Object.values(videos_info));let rec_div=document.querySelector('#related_videos');empty_element(rec_div);for(let vid_info of rec_vids){ if(vid_info.id==VIDEO_ID)continue;add_rec_vid(rec_div, vid_info, "eager", 320,);};};function prompt_player(video_id){ console.log("prompt_player with video_id:", video_id);let video_container=document.querySelector('.video-container');let t=URLPARAMS.get('t');if(!EMBED){ let video=document.querySelector('video');video.style.backgroundImage=`url(${get_thumb_urls(video_id)['maxres']})`;video_container.classList.remove('src-loaded');video_container.classList.add('controls-active');video_container.classList.add('paused');if(!PLAY_WHEN_CLICKED){ destroyVideo(false);} else { video.src=get_download_url(video_id);video.load();};if(t){ console.log("setting time:", t);video.currentTime=t / 1000;};video_container.dataset.mode='sleebi';} else { if(!t){t=0;};yt_player.loadVideoById(VIDEO_ID, t / 1000);video_container.dataset.mode='yt';video_container.classList.add('unstarted');} PREV_EMBED=EMBED;};function load_yt_player(){ if(!window.YT ||!window.YT.Player){ console.log("placeWatchContent:yt iframe api not loaded yet, waiting...");window.addEventListener('yt_iframe_api_ready', load_yt_player);return;};yt_player=place_player(VIDEO_ID, 'main-video-element', 640, 360, undefined, { 'onReady':()=>{ console.log("yt_player ready");window.dispatchEvent(new Event('yt_player_ready'));window.dispatchEvent(new Event('player_ready'));}, 'onStateChange':(event)=>{ if(event.data==1){ window.dispatchEvent(new Event('play'));document.querySelector('.video-container').classList.remove('unstarted');} else if(event.data==2){ window.dispatchEvent(new Event('pause'));} else if(event.data==3){ window.dispatchEvent(new Event('buffering'));} else if(event.data==0){ window.dispatchEvent(new Event('ended'));} else if(event.data==-1){ window.dispatchEvent(new Event('loadeddata'));};} });};function add_share_overlay(){ let video=document.querySelector('video');video.pause();let starttime=format_ms_as_time(video.currentTime * 1000);let url=get_video_url(VIDEO_ID, EMBED);let overlay_content=create_overlay(document.body, 'share_overlay', true, null, true);overlay_content=create_and_append('div', overlay_content, null, 'share_overlay_content');overlay_content.innerHTML=`<h5>Share</h5><div id="share_url_container" class="flex-container"><input type="text" id="share_url" class="wide_input" value="${url}"><button id="copy_url_btn" class="btn">Copy</button></div><div id="share_option_container"><input type="checkbox" id="share_starttime_checkbox"><label for="share_starttime_checkbox">Start at:</label><input type="text" id="share_starttime" class="time_input" disabled value="${starttime}"></div>`;let copy_url_btn=document.querySelector('#copy_url_btn');copy_url_btn.addEventListener('click', function(){ navigator.clipboard.writeText(document.querySelector('#share_url').value).then(function(){ create_message_overlay('Link copied to clipboard');});});function update_url(){ let incl_time=document.querySelector('#share_starttime_checkbox').checked;let textarea=document.querySelector('#share_url');let val=textarea.value;let index=val.indexOf('&t=');if(index!=-1){ val=val.slice(0, index);};let t;try { t=calc_ms_from_time(share_starttime.value);} catch(error){ console.log(error);return;};if(t==0 ||!incl_time){ textarea.value=val;return;};val+=`&t=${calc_ms_from_time(share_starttime.value)}`;textarea.value=val;};let share_starttime_checkbox=document.querySelector('#share_starttime_checkbox');share_starttime_checkbox.addEventListener('click', function(){ let share_starttime=document.querySelector('#share_starttime');if(share_starttime_checkbox.checked){ share_starttime.disabled=false;update_url();} else { share_starttime.disabled=true;update_url();};});let share_starttime=document.querySelector('#share_starttime');share_starttime.addEventListener('input', update_url);};var URLPARAMS=new URLSearchParams(window.location.search);var PATHNAME=window.location.pathname.split("/").splice(1);var VIDEO_ID;var QUERY;update_page_based_on_url();let search_bar=document.querySelector('#navbar #search_bar');search_bar.addEventListener('submit', function(e){ e.preventDefault();let query=document.querySelector('#navbar #search-input').value;if(query.includes('youtube.com/watch?v=')){ let video_id=query.split('youtube.com/watch?v=')[1].split('&')[0];redirect_watch(video_id, embed=true);return;} else if(query.includes('youtu.be/')){ let video_id=query.split('youtu.be/')[1].split('?')[0];redirect_watch(video_id, embed=true);return;};console.log("search query entered:", query);redirect_results(query);});let search_open_btn=document.querySelector('#search_open_btn');search_open_btn.addEventListener('click', function(){ document.querySelector('#navbar').dataset.mode="search";});let search_close_btn=document.querySelector('#search_close_btn');search_close_btn.addEventListener('click', function(){ document.querySelector('#navbar').dataset.mode="default";});let tip_btn=document.querySelector('#tip_btn');tip_btn.addEventListener('click', function(){ let overlay_content=create_overlay(document.body, 'tip_overlay', true, null, true);overlay_content=create_and_append('div', overlay_content);overlay_content.innerHTML=`<iframe id='kofiframe' src='https://ko-fi.com/obviouslyluuk/?hidefeed=true&widget=true&embed=true&preview=true' style=' /* position:absolute;width:100%;top:-120px;left:0;right:0;*/ transform:translateY(-125px);border:none;filter:invert(1)hue-rotate(180deg)grayscale(0);border-radius:10px;' height='800' title='kofi-obviouslyluuk'></iframe>`;overlay_content.style['max-height']="min(90vh, 545px)";overlay_content.parentElement.parentElement.style['background-color']="black";overlay_content.parentElement.parentElement.style['padding']="0";overlay_content.parentElement.parentElement.style['width']="unset";overlay_content.parentElement.parentElement.style['border']="2px solid white";});let link;document.body.dataset.mobile=mobileCheck();document.body.dataset.tablet=tabletCheck();document.body.dataset.ios=iOSCheck();function updateLandscape(){ if(window.innerWidth>window.innerHeight){ document.body.dataset.landscape="true";} else { document.body.dataset.landscape="false";};};window.addEventListener('resize', function(){ let elem=document.querySelector('style#innerHeight');if(!elem){ elem=document.createElement('style');elem.id="innerHeight";document.head.appendChild(elem);};elem.innerText=`:root { --innerHeight:${window.innerHeight}px!important;}`;if(!window.mobileCheck())return;updateLandscape();});window.dispatchEvent(new Event('resize'));function update_page_based_on_url(){ if(window.location.href.includes('/v.html')){ let state=window.history.state;window.history.replaceState(state, null, window.location.href.replace('/v.html', '/'));console.log("replaced /v.html with /");} URLPARAMS=new URLSearchParams(window.location.search);PATHNAME=window.location.pathname.split("/").splice(1);console.log("new params:", URLPARAMS.toString());switch(PATHNAME[0]){ case "":if(URLPARAMS.get('v')){ console.log("placing watch page");placeWatchContent();if(!document.querySelector('#content-container').dataset.page){ placeHomeContent();} } else if(URLPARAMS.get('q')){ console.log("placing results page");placeResultsContent();window.dispatchEvent(new Event('enterpip'));} else { console.log("placing home page");placeHomeContent();window.dispatchEvent(new Event('enterpip'));};break;default:console.log("unknown pathname. error page not yet implemented");break;};};if(window.location.hostname!="localhost"){ let script=document.createElement('script');script.src="js/util/piwik.js";script.async=true;script.defer=true;document.body.insertBefore(script, document.body.firstChild);};window.addEventListener('pushstate', update_page_based_on_url);window.addEventListener('popstate', update_page_based_on_url);create_message_overlay('Sleebi is a work in progress, so keep in mind some features might not work', document.body, 5000);/** * https://github.com/WebDevSimplified/youtube-video-player-clone/tree/main */ const videoPlayerContainer=document.querySelector(".vid_player_container");const playPauseBtns=document.querySelectorAll(".play-pause-btn");const fullScreenBtn=document.querySelector(".full-screen-btn");const muteBtn=document.querySelector(".mute-btn");const brightnessBtn=document.querySelector(".brightness-btn");const blueFilterBtn=document.querySelector(".blue-filter-btn");const loopBtn=document.querySelector(".loop-btn");const currentTimeElem=document.querySelector(".current-time");const totalTimeElem=document.querySelector(".total-time");const thumbnailImg=document.querySelector(".thumbnail-img");const volumeSlider=document.querySelector(".volume-slider");const brightnessSlider=document.querySelector(".brightness-slider");const videoContainer=document.querySelector(".video-container");const timelineContainer=document.querySelector(".timeline-container");const videoWrapper=document.querySelector(".video-wrapper");const brightnessWrapper=document.querySelector(".video-brightness-wrapper");const video=document.querySelector("video");const pipPlayer=document.querySelector(".pip-player-controls");const pipPlayerStyle=document.querySelector("style#pipplayer");const pipCloseBtn=document.querySelector(".pip-close-btn");const skipBackOverlay=document.querySelector(".skip-back");const skipForwardOverlay=document.querySelector(".skip-forward");const videoError=document.querySelector(".video-error-div");document.addEventListener("keydown", e=>{ const tagName=document.activeElement.tagName.toLowerCase();if(tagName==="input")return;switch(e.key.toLowerCase()){ case " ":if(tagName==="button")return;case "k":togglePlay();break;case "f":toggleFullScreenMode();break;case "m":toggleMute();break;case "arrowleft":skip(-5);break;case "j":skip(-10);break;case "arrowright":skip(5);break;case "l":skip(10);break;};});timelineContainer.addEventListener("mousemove", handleTimelineUpdate);timelineContainer.addEventListener("mousedown", toggleScrubbing);document.addEventListener("mouseup", e=>{ if(isScrubbing)toggleScrubbing(e);});document.addEventListener("mousemove", e=>{ if(isScrubbing)handleTimelineUpdate(e);});timelineContainer.addEventListener("touchmove", e=>{ e={x:e.touches[0].clientX, buttons:1, preventDefault:()=>{}, type:'touchmove'};handleTimelineUpdate(e);});timelineContainer.addEventListener("touchstart", e=>{ e={x:e.touches[0].clientX, buttons:1, preventDefault:()=>{}, type:'touchstart'};toggleScrubbing(e);});document.addEventListener("touchend", e=>{ if(isScrubbing){ e={x:e.changedTouches[0].clientX, buttons:0, preventDefault:()=>{}, type:'touchend'};toggleScrubbing(e);};});document.addEventListener("touchmove", e=>{ if(isScrubbing){ e={x:e.touches[0].clientX, buttons:1, preventDefault:()=>{}, type:'touchmove'};handleTimelineUpdate(e);};});let isScrubbing=false;let wasPaused;function toggleScrubbing(e){ if((document.body.dataset.mobile=="true" || document.body.dataset.tablet=="true")&&(e instanceof MouseEvent)){return};const rect=timelineContainer.getBoundingClientRect();const percent=Math.min(Math.max(0, e.x - rect.x), rect.width)/ rect.width;isScrubbing=(e.buttons & 1)===1;videoContainer.classList.toggle("scrubbing", isScrubbing);if(isScrubbing){ wasPaused=getPaused();pause();} else { setTime(percent * getDuration());if(!wasPaused){ play();};};handleTimelineUpdate(e);};function handleTimelineUpdate(e){ const rect=timelineContainer.getBoundingClientRect();const percent=Math.min(Math.max(0, e.x - rect.x), rect.width)/ rect.width;timelineContainer.style.setProperty("--preview-position", percent);if(isScrubbing){ e.preventDefault();timelineContainer.style.setProperty("--progress-position", percent);setTime(percent * getDuration());currentTimeElem.textContent=formatDuration(getTime());};};video.addEventListener("loadeddata",()=>{ totalTimeElem.textContent=formatDuration(getDuration());});window.addEventListener("loadeddata",()=>{ let interval=setInterval(()=>{ if(yt_player && yt_player.getDuration && getDuration()){ totalTimeElem.textContent=formatDuration(getDuration());clearInterval(interval);} }, 500);});video.addEventListener("timeupdate", handleTimeUpdate);let ytPlayerTimeUpdateInterval;window.addEventListener("yt_player_ready",()=>{ ytPlayerTimeUpdateInterval=setInterval(handleTimeUpdate, 1000);});function handleTimeUpdate(){ if(EMBED &&(!yt_player ||!yt_player.getCurrentTime)){return;};let time=getTime();currentTimeElem.textContent=formatDuration(time);let percent=time / getDuration();timelineContainer.style.setProperty("--progress-position", percent);if(EMBED){loopYtPlayer();};};const leadingZeroFormatter=new Intl.NumberFormat(undefined, { minimumIntegerDigits:2, });function formatDuration(time){ const seconds=Math.floor(time % 60);const minutes=Math.floor(time / 60)% 60;const hours=Math.floor(time / 3600);if(hours===0){ return `${minutes}:${leadingZeroFormatter.format(seconds)}`;} else { return `${hours}:${leadingZeroFormatter.format(minutes)}:${leadingZeroFormatter.format(seconds)}`;};};function skip(duration){ setTime(getTime()+duration);let skipOverlay=duration<0 ? skipBackOverlay:skipForwardOverlay;skipOverlay.querySelector('span').textContent=`${duration<0 ? "":"+"}${duration} seconds`;skipOverlay.classList.remove("active");void skipOverlay.offsetWidth;skipOverlay.classList.add("active");setTimeout(()=>{ skipOverlay.classList.remove("active");}, 500);};muteBtn.addEventListener("click", toggleMute);volumeSlider.addEventListener("input", e=>{ if(EMBED){ yt_player.setVolume(e.target.value * 100);handleVolumeChange(e.target.value);} else { video.volume=e.target.value;video.muted=e.target.value===0;};});function toggleMute(){ if(EMBED){ let was_muted=yt_player.isMuted();was_muted ? yt_player.unMute():yt_player.mute();handleVolumeChange(!was_muted ? 0:yt_player.getVolume()/ 100);} else { video.muted=!video.muted;};};video.addEventListener("volumechange",()=>{ handleVolumeChange();});function handleVolumeChange(volume=null){ if(volume==null){ volume=video.muted ? 0:video.volume;};volumeSlider.value=volume;let volumeLevel;if(volume==0){ volumeSlider.value=0;volumeLevel="muted";} else if(volume>=0.5){ volumeLevel="high";} else { volumeLevel="low";};videoContainer.dataset.volumeLevel=volumeLevel;};function setBrightnessStyle(brightness){ let str=`brightness(${brightness})`;if(!brightness)str='';brightnessWrapper.style.filter=str;thumbnailImg.style.filter=str;} brightnessBtn.addEventListener("click", toggleBrightness);brightnessSlider.addEventListener("input", e=>{ setBrightnessStyle(e.target.value);window.dispatchEvent(new Event('brightnesschange'));});window.addEventListener("brightnesschange",()=>{ let brightnessLevel;if(brightnessSlider.value<0.01){ brightnessLevel="muted";} else if(brightnessSlider.value>=0.5){ brightnessLevel="high";} else { brightnessLevel="low";};videoContainer.setAttribute("data-brightness-level", brightnessLevel);});let lastBrightness=0;function toggleBrightness(){ switch(brightnessSlider.value){ case "0":brightnessSlider.value=lastBrightness;break;default:lastBrightness=brightnessSlider.value;brightnessSlider.value=0;break;};setBrightnessStyle(brightnessSlider.value);if(brightnessSlider.value==1){ setBrightnessStyle(null);};window.dispatchEvent(new Event('brightnesschange'));};blueFilterBtn.addEventListener("click", toggleBlueFilter);function toggleBlueFilter(){ let bf=document.body.classList.toggle("blue-filter");requestAnimationFrame(()=>{ if(create_message_overlay){ let message=`Blue light filter ${bf ? 'enabled':'disabled'}`;create_message_overlay(message);};});};fullScreenBtn.addEventListener("click", toggleFullScreenMode);function toggleFullScreenMode(){ if(iOSCheck()){ toggleIOSViewerMode();return;};if(document.fullscreenElement==null){ videoContainer.requestFullscreen();} else { document.exitFullscreen();};};function toggleIOSViewerMode(){ if(EMBED){ create_message_overlay("Can't enter fullscreen on iOS in embed mode\nTry holding your phone sideways:)", document.body, 5000);return;} let waspaused=video.paused;video.pause();video.webkitEnterFullscreen();if(!waspaused){video.play()};};document.addEventListener("fullscreenchange",()=>{ videoContainer.classList.toggle("full-screen", document.fullscreenElement);});playPauseBtns.forEach(e=>{e.addEventListener("click", togglePlay)});videoWrapper.addEventListener("click", function(e){ if(mobileCheck()|| tabletCheck()){ toggleControls();} else { togglePlay();};});function togglePlay(){ window.dispatchEvent(new Event('play_requested'));try { getPaused()? play():pause();} catch(error){ console.log("Error:", error);};};video.addEventListener("play",()=>{ videoContainer.classList.remove("paused");});window.addEventListener("play",()=>{ videoContainer.classList.remove("paused");});video.addEventListener("pause",()=>{ videoContainer.classList.add("paused");});window.addEventListener("pause",()=>{ videoContainer.classList.add("paused");});function play(){ EMBED ? yt_player.playVideo():video.play();};function pause(){ EMBED ? yt_player.pauseVideo():video.pause();};function stopVideo(){ EMBED ? yt_player.stopVideo():video.pause();};function destroyVideo(embed=false){ PREV_VIDEO_ID=null;PREV_EMBED=null;if(embed && yt_player){ clearInterval(ytPlayerTimeUpdateInterval);yt_player.destroy();yt_player=null;} else { video.src="";video.load();};};function getPaused(){ if(EMBED){ if(!yt_player ||!yt_player.getPlayerState){return true};return yt_player.getPlayerState()!=1;} else { return video.paused;};};function setTime(time){ EMBED ? yt_player.seekTo(time):video.currentTime=time;};function getTime(){ return EMBED ? yt_player.getCurrentTime():video.currentTime;};function getDuration(){ return EMBED ? yt_player.getDuration():video.duration;};var LOOPING=false;function setLoop(loop){ LOOPING=loop;video.loop=loop;};function getLoop(){ return EMBED ? LOOPING:video.loop;};function loopYtPlayer(){ if(getDuration()==0 ||!getDuration()){return;};if(getDuration()- getTime()>2){return;};if(LOOPING){ yt_player.seekTo(0);console.log("Looping");} else { yt_player.pauseVideo();setTime(getDuration()- 2.1);console.log("Pausing before end");video.dispatchEvent(new Event('ended'))};};var AUTOPLAY=false;document.querySelector("#autoplay_switch").addEventListener("change", e=>{ AUTOPLAY=e.target.checked;create_message_overlay(`Autoplay ${AUTOPLAY ? 'enabled':'disabled'}`);});video.addEventListener("ended",()=>{ if(getLoop()){return;};if(AUTOPLAY){ autoplay_video();};});let controlsTimeout;function toggleControls(force=undefined){ clearTimeout(controlsTimeout);videoContainer.classList.toggle("controls-active", force);if(!getPaused()&& videoContainer.classList.contains("controls-active")){ controlsTimeout=setTimeout(()=>{ videoContainer.classList.remove("controls-active");}, 2000);};};video.addEventListener("play",()=>{ toggleControls(true);});window.addEventListener("play",()=>{ toggleControls(true);});const control_elements=[ videoContainer.querySelector(".controls"), videoContainer.querySelector(".timeline-container"), videoContainer.querySelector(".play-pause-btn"), videoContainer.querySelector(".volume-slider"), videoContainer.querySelector(".brightness-slider"), videoContainer.querySelector(".full-screen-btn"), videoContainer.querySelector(".mute-btn"), videoContainer.querySelector(".blue-filter-btn"), videoContainer.querySelector(".loop-btn"), videoContainer.querySelector(".current-time"), videoContainer.querySelector(".total-time"), ];control_elements.forEach(e=>{e.addEventListener("touchstart",()=>{toggleControls(true)})});control_elements.forEach(e=>{e.addEventListener("touchmove",()=>{toggleControls(true)})});control_elements.forEach(e=>{e.addEventListener("touchend",()=>{toggleControls(true)})});videoWrapper.addEventListener("pause",()=>{ clearTimeout(controlsTimeout);});let lastTap=0;videoWrapper.addEventListener("touchstart", e=>{ const rect=videoWrapper.getBoundingClientRect();if(e.touches[0].clientX>rect.width / 3 && e.touches[0].clientX<rect.width * 2 / 3){ return;};const timeSinceLastTap=Date.now()- lastTap;if(timeSinceLastTap<300){ if(e.touches[0].clientX<rect.width / 2){ skip(-5);} else { skip(5);};};lastTap=Date.now();});var startY=0;var isDragging=false;let drag_elems=[pipPlayer.querySelector('.pip-player-info'),videoWrapper];drag_elems.forEach(e=>{e.addEventListener("touchstart", e=>{ startY=e.touches[0].clientY;watch_overlay.classList.add("dragging");document.body.style.overflow="hidden";})});drag_elems.forEach(e=>{e.addEventListener("touchmove", e=>{ let deltaY=e.touches[0].clientY - startY;if(isDragging &&!document.body.classList.contains("pip")){ let translation=Math.min(Math.max(0, deltaY), window.innerHeight);watch_overlay.style.top=`${translation}px`;} else if(isDragging && document.body.classList.contains("pip")){ let translation=Math.max(Math.min(Math.min(0, deltaY), window.innerHeight), -window.innerHeight);watch_overlay.style.top=`${window.innerHeight+translation}px`;pipPlayerStyle.innerHTML=` .video-wrapper { bottom:${-translation}px!important;opacity:${1 - Math.min(Math.abs(translation)/(window.innerHeight/2), 1)};} .pip-player-controls { bottom:${-translation}px;opacity:${1 - Math.min(Math.abs(translation)/(window.innerHeight/2), 1)};} `;} else { isDragging=true;};})});drag_elems.forEach(e=>{e.addEventListener("touchend", e=>{ watch_overlay.classList.remove("dragging");if(!isDragging)return;let deltaY=e.changedTouches[0].clientY - startY;if(deltaY>videoContainer.clientHeight / 3){ let no_pip_change=document.body.classList.contains("pip");window.dispatchEvent(new Event('enterpip'));if(no_pip_change){return;};push_state_behind_watchpage();} else { let no_pip_change=!document.body.classList.contains("pip");window.dispatchEvent(new Event('exitpip'));if(no_pip_change){return;};window.history.pushState({page:"watch",video_id:VIDEO_ID, embed:EMBED}, null, get_video_url(VIDEO_ID, EMBED, undefined, relative=true));console.log("Pushed state with "+VIDEO_ID);};})});drag_elems[0].addEventListener("click",()=>{ window.dispatchEvent(new Event('exitpip'));window.history.pushState({page:"watch",video_id:VIDEO_ID, embed:EMBED}, null, get_video_url(VIDEO_ID, EMBED, undefined, relative=true));console.log("Pushed state with "+VIDEO_ID);});function pip_refresh(){ pipPlayerStyle.innerHTML='';watch_overlay.classList.remove("dragging");document.body.style.overflow="";isDragging=false;};window.addEventListener("enterpip",()=>{ document.body.classList.add("pip");watch_overlay.style.top="";pip_refresh();});window.addEventListener("exitpip",()=>{ document.body.classList.remove("pip");watch_overlay.style.top="";pip_refresh();});pipCloseBtn.addEventListener("click",()=>{ stopVideo();document.body.classList.remove("pip");document.body.classList.remove("watch");document.body.style.overflow="";pipPlayerStyle.innerHTML=` .video-wrapper { bottom:${-100}px!important;} .pip-player-controls { bottom:${-100}px;} `;});function push_state_behind_watchpage(){ let content_container=document.querySelector('#content-container');if(content_container.dataset.page=="home"){ window.history.pushState({page:"home"}, null, '/');console.log("Pushed state with /");} else if(content_container.dataset.page=="results"){ window.history.pushState({page:"results",query:QUERY}, null, '/?q='+QUERY);console.log("Pushed state with /?q="+QUERY);};};loopBtn.addEventListener("click", toggleLoop);function toggleLoop(){ setLoop(!getLoop());loopBtn.classList.toggle("active", getLoop());};/** * Sets the video time to the given time in milliseconds. Scrolls the video into view. * Shows the video controls if they are hidden. * * @param {number} time - The time in milliseconds. * @returns {void} */ window.seekTo=function(time){ setTime(time / 1000);videoWrapper.scrollIntoView();toggleControls(true);};video.addEventListener('loadstart',()=>{ videoContainer.classList.add('src-loading');});video.addEventListener('loadeddata',()=>{ videoContainer.classList.remove('src-loading');videoContainer.classList.add('src-loaded');});window.addEventListener("yt_player_ready",()=>{ videoContainer.classList.remove('src-loading');videoContainer.classList.add('src-loaded');});window.addEventListener("keydown", e=>{ if(e.key===" "){ e.preventDefault();};});const buttons=document.querySelectorAll(".clickable_icon");buttons.forEach(button=>{ button.addEventListener("click",()=>{ button.classList.add("clicked");});button.addEventListener("animationend",()=>{ button.classList.remove("clicked");});});video.addEventListener("error",()=>{ if(EMBED){return;};console.log("Video error:", video.error);if(video.error.message!=undefined && video.error.message.includes("Empty src attribute")){return;};destroyVideo(embed=false);redirect_watch(VIDEO_ID, embed=true, replace=true);create_message_overlay("switching to embed player");return;videoContainer.classList.remove('src-loading');videoContainer.classList.remove('src-loaded');switch(video.error.code){ case 1:videoError.innerHTML="Aborted";break;case 2:videoError.innerHTML="Network error";break;case 3:videoError.innerHTML="Decode error";break;case 4:videoError.innerHTML=`<span>Due to immense data transfer costs I had to pause the website because it was very quickly draining my bank account. I'll try to find solutions to further limit the cost!Stay up to date at:</span><a href="https://www.youtube.com/@ObviouslyASMR/community" class="btn rounded" target="_blank">My YouTube Community</a><span>embed this video from YouTube(but it stops before the postroll ad):</span><a class="btn rounded" onclick="redirect_watch('${VIDEO_ID}',true)">Watch Embedded</a><span>or watch a short demo I kept available on the Sleebi servers:</span><a class="btn rounded" onclick="redirect_watch('demo480x852')">Demo</a>`;break;default:videoError.innerHTML="Unknown error";break;} videoError.classList.add("active");});window.addEventListener("pushstate",()=>{ videoError.classList.remove("active");});window.dispatchEvent(new Event('player_js_ready'));if(!EMBED){video.load();};